<!DOCTYPE html>
<html lang="fr">
<head>

  <!-- META BASIQUE -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>GÃ©o-Quiz | Accueil</title>

  <!-- SEO -->
  <meta name="description" content="Jeu Ã©ducatif de GÃ©ographie et Histoire avec niveaux, XP et dÃ©fis.">
  <meta name="author" content="GÃ©o-Quiz">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#00f2fe">
  <link rel="apple-touch-icon" href="icons/icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- PERFORMANCE FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/style.css">

</head>

<body>

<header class="main-header">

  <!-- Badge XP -->
  <div class="xp-badge">
    â­ <span id="xpValue">0</span> XP
  </div>

  <div class="header-left"></div>

  <!-- TITRE CENTRÃ‰ -->
  <h1 class="logo centered-title">
    <img src="icons/icon.png" alt="GÃ©o-Quiz" class="title-icon">
    GÃ©o-Quiz & Histo-Quiz
  </h1>

  <div class="header-right">

    <div class="player-info">
      ğŸ‘¤ <span id="usernameDisplay">InvitÃ©</span>

      <div class="level-info">
        â­ Niveau <span id="level">1</span>

        <div class="xp-bar">
          <div id="xpFill"></div>
        </div>

        <div id="rank"></div>
      </div>
    </div>

    <!-- Toggle Soleil / Lune -->
    <div class="theme-toggle-premium" id="themeToggle">
      <div class="toggle-circle">
        <span class="icon sun">â˜€ï¸</span>
        <span class="icon moon">ğŸŒ™</span>
      </div>
    </div>

  </div>

</header>

<main class="centered landing">

  <h2 class="welcome-title">
    Bienvenue sur <span class="gradient-text">GÃ©o-Quiz</span>
  </h2>

  <p class="subtitle">
    Teste tes connaissances en GÃ©ographie et en Histoire
  </p>

  <!-- SECTION UTILISATEUR -->
  <div id="userSection" class="user-box">
    <input 
      type="text" 
      id="usernameInput" 
      placeholder="Entrez votre pseudo"
      maxlength="15"
      autocomplete="off"
    >
    <button id="saveBtn" class="main-btn">
      Valider
    </button>
  </div>

  <!-- BOUTON START -->
  <button id="startBtn" class="main-btn big-btn hidden">
    ğŸš€ Commencer l'aventure
  </button>

</main>

<!-- =========================
        POPUP UPDATE
========================= -->

<div id="updatePopup" class="update-popup hidden">
  ğŸš€ Nouvelle version disponible
  <button onclick="updateApp()">Mettre Ã  jour</button>
</div>

<!-- =========================
        INDICATEUR OFFLINE
========================= -->

<div id="offlineIndicator" class="offline-indicator hidden">
  ğŸ“¡ Mode hors ligne
</div>

<!-- =========================
         SCRIPTS
========================= -->

<script src="js/stats.js" defer></script>
<script src="js/user.js" defer></script>
<script src="js/theme.js" defer></script>
<script src="js/transition.js" defer></script>
<script src="js/navigation.js" defer></script>

<!-- SERVICE WORKER + FEATURES PREMIUM -->
<script>

if ("serviceWorker" in navigator) {

  window.addEventListener("load", () => {

    navigator.serviceWorker.register("service-worker.js")
      .then(reg => {

        reg.onupdatefound = () => {

          const newWorker = reg.installing;

          newWorker.onstatechange = () => {

            if (
              newWorker.state === "installed" &&
              navigator.serviceWorker.controller
            ) {
              document
                .getElementById("updatePopup")
                .classList.remove("hidden");
            }

          };
        };

      })
      .catch(() => {});
  });
}

/* UPDATE SILENCIEUSE */
function updateApp(){

  navigator.serviceWorker.getRegistration().then(reg => {

    if(reg && reg.waiting){
      reg.waiting.postMessage("SKIP_WAITING");
    }

    window.location.reload();
  });
}

/* INDICATEUR ONLINE / OFFLINE */
function updateOnlineStatus(){

  const indicator = document.getElementById("offlineIndicator");

  if(!navigator.onLine){
    indicator.classList.remove("hidden");
  } else {
    indicator.classList.add("hidden");
  }
}

window.addEventListener("online", updateOnlineStatus);
window.addEventListener("offline", updateOnlineStatus);
updateOnlineStatus();

/* XP BADGE */
document.addEventListener("DOMContentLoaded", () => {

  if(typeof updateXPBadge === "function"){
    updateXPBadge();
  }

});

</script>

</body>
</html>